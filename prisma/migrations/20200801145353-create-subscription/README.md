# Migration `20200801145353-create-subscription`

This migration has been generated by Rafael Rozendo at 8/1/2020, 2:53:53 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "subscription_state" AS ENUM ('pending', 'active', 'cancelled');

CREATE TABLE "public"."contribution_subscriptions" (
"amount_in_cents" integer  NOT NULL ,"email" text  NOT NULL ,"id" SERIAL,"state" "subscription_state" NOT NULL ,
    PRIMARY KEY ("id"))

ALTER TABLE "public"."contributions" ADD COLUMN "subscription_id" integer   ;

ALTER TABLE "public"."contributions" ADD FOREIGN KEY ("subscription_id")REFERENCES "public"."contribution_subscriptions"("id") ON DELETE SET NULL  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200704163652-create-contributions..20200801145353-create-subscription
--- datamodel.dml
+++ datamodel.dml
@@ -2,9 +2,9 @@
 // learn more about it in the docs: https://pris.ly/d/prisma-schema
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider = "prisma-client-js"
@@ -17,12 +17,36 @@
   @@map("contribution_state")
 }
+enum SubscriptionState {
+  pending
+  active
+  cancelled
+
+  @@map("subscription_state")
+}
+
+model ContributionSubscription {
+  id Int @default(autoincrement()) @id
+  state SubscriptionState
+  amountInCents Int @map("amount_in_cents")
+  email String
+  contributions Contribution[]
+
+  @@map("contribution_subscriptions")
+}
+
 model Contribution {
   id Int @default(autoincrement()) @id
   state ContributionState
   amountInCents Int @map("amount_in_cents")
   email String
+  subscriptionId Int? @map("subscription_id")
+  subscription ContributionSubscription? @relation(fields: [subscriptionId], references: [id])
   @@map("contributions")
-}
+}
+
+
+
+//TODO: add timestamps
```


