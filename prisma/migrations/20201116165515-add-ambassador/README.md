# Migration `20201116165515-add-ambassador`

This migration has been generated by Tomaz Medrado at 11/16/2020, 4:55:15 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."ambassadors" (
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"id" SERIAL,"is_active" boolean  NOT NULL ,
    PRIMARY KEY ("id"))

ALTER TABLE "public"."contribution_subscriptions" ADD COLUMN "ambassador_id" integer   ;

ALTER TABLE "public"."contributions" ADD COLUMN "ambassador_id" integer   ;

ALTER TABLE "public"."users" ADD COLUMN "ambassador_id" integer   ;

CREATE UNIQUE INDEX "users_ambassador_id" ON "public"."users"("ambassador_id")

ALTER TABLE "public"."contribution_subscriptions" ADD FOREIGN KEY ("ambassador_id")REFERENCES "public"."ambassadors"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."contributions" ADD FOREIGN KEY ("ambassador_id")REFERENCES "public"."ambassadors"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."users" ADD FOREIGN KEY ("ambassador_id")REFERENCES "public"."ambassadors"("id") ON DELETE SET NULL  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20201024110143-add-user..20201116165515-add-ambassador
--- datamodel.dml
+++ datamodel.dml
@@ -2,9 +2,9 @@
 // learn more about it in the docs: https://pris.ly/d/prisma-schema
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider = "prisma-client-js"
@@ -33,8 +33,10 @@
   email String
   contributions Contribution[]
   externalId String? @map("external_id")
   experimentId String? @map("experiment_id")
+  referencedBy Ambassador? @relation(fields: [ambassadorId], references: [id])
+  ambassadorId Int? @map("ambassador_id")
   @@map("contribution_subscriptions")
 }
@@ -47,8 +49,10 @@
   subscription ContributionSubscription? @relation(fields: [subscriptionId], references: [id])
   externalId String? @map("external_id")
   createdAt DateTime @default(now())
   experimentId String? @map("experiment_id")
+  referencedBy Ambassador? @relation(fields: [ambassadorId], references: [id])
+  ambassadorId Int? @map("ambassador_id")
   @@map("contributions")
 }
@@ -65,7 +69,18 @@
   volunteeringInterest Boolean @map("volunteering_interest")
   contributions Contribution[]
   subscriptions ContributionSubscription[]
   createdAt DateTime @default(now())
+  referencedBy Ambassador? @relation(fields: [ambassadorId], references: [id])
+  ambassadorId Int? @map("ambassador_id")
   @@map("users")
 }
+
+model Ambassador {   
+    id Int @default(autoincrement()) @id   
+    user User
+    isActive Boolean @map("is_active")  
+    createdAt DateTime @default(now()) 
+
+    @@map("ambassadors")
+}
```


